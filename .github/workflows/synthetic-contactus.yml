name: Synthetic Contact Us (QA)

on:
  schedule:
    - cron: "0 */2 * * *"   # every 2 hours
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: Submit Contact Us form and verify
        env:
          CONTACT_URL: ${{ secrets.QA_CONTACT_URL }}
          SUCCESS_TEXT: ${{ secrets.CONTACT_SUCCESS_TEXT }}
        run: |
          python - <<'PY'
          import os, sys, urllib.parse, urllib.request
          payload = {
              "name": "Synthetic Monitor",
              "email": "monitor@saayam.org",
              "message": "synthetic run"
          }
          data = urllib.parse.urlencode(payload).encode("utf-8")
          req = urllib.request.Request(os.environ["CONTACT_URL"], data=data, method="POST")
          try:
              with urllib.request.urlopen(req, timeout=20) as r:
                  code = r.getcode()
                  body = r.read().decode("utf-8", "ignore")
          except Exception as e:
              print("FAILED: request error ->", e); sys.exit(1)

          if code != 200:
              print("FAILED: HTTP", code); sys.exit(1)

          if os.environ["SUCCESS_TEXT"].lower() not in body.lower():
              print("FAILED: success text missing"); sys.exit(1)

          print("OK: form posted and success text found")
          PY
